# How-to: Configure Voice Gateway

## Introduction

{% include from="B03-06_0138-Amelia-Voice-Gateway-Intro.md" element-id="B03-06_0138-Amelia-Voice-Gateway-Intro_snippet" /%}

If you have a complex integration with call center software or your own voice infrastructure, please contact the Voice team for guidance.

## What You'll Learn

In this topic you'll learn how to:

* [Access the gateway configuration workspace](#Access).
* [Add the Amelia Voice Gateway](#Add).

## Configure Amelia

To use the Voice gateway, you must access the workspace and add the gateway.

###Access the Gateway Configuration Workspace {% #Access %}

To access the Gateway Integrations workspace:

1. From the **top left main** menu, click **Digital Employees**.
2. On the **left-side** menu, click **Integrations**.
3. From the flyout menu, click **Gateway Integrations**.

The **Gateway Integrations** panel opens between the left-side menu and the Home page.

{% include from="B03-06_0138-Collapse-Panel-Tip.md" element-id="B03-06_0138-Collapse-Panel-Tip_snippet" /%}

###Add the Voice Gateway {% #Add %}

Open these dropdowns to learn about the elements you'll see when adding an Voice gateway.

<chapter title="General Elements" collapsible="true" level="5">

![B03-06_0138-Voice-GW-Basic-Tab-General](B03-06_0138-Voice-GW-Basic-Tab-General.png){width="900" style="block"}

*The Voice Gateway Basic Tab, General Elements*

*Voice Gateway Basic Tab, General Elements*

|       Element        |         Default         |                                                Description                                                 |
|----------------------|-------------------------|------------------------------------------------------------------------------------------------------------|
| Save button          |                         | Click to update the new Integration Gateway page with changes made.                                        |
| Name                 |                         | {% include from="B03-06_GateCom-Domain.md" element-id="B03-06_GateCom-Domain_snippet" /%}             |
| Domain               | Your Domain             | {% include from="B03-06_GateCom-Domain.md" element-id="B03-06_GateCom-Domain_snippet" /%}             |
| Gateway Service      |                         | {% include from="B03-06_GateCom-GateSrv.md" element-id="B03-06_GateCom-GateSrv_snippet" /%}           |
| Deploy               | No                      | Click the Yes or No radio button to deploy or not deploy the gateway.                                      |
| Configuration Locale | English (United States) | {% include from="B03-06_GateCom-ConfigLocale.md" element-id="B03-06_GateCom-ConfigLocale_snippet" /%} |


</chapter>

<chapter title="Configuration Elements" collapsible="true" level="5">

![B03-06_0138-Voice-GW-Basic-Tab-Config](B03-06_0138-Voice-GW-Basic-Tab-Config.png){width="900" style="block"}

*The Voice Gateway Basic Tab, Configuration Elements*

*Voice Gateway Basic Tab, Configuration Elements*

|   Element    | Default |                                Description                                |
|--------------|---------|---------------------------------------------------------------------------|
| Configuration                                                                                    |||
| STT Provider |         | Select the STT (speech-to-text) service provider to use with the gateway. |
| TTS Provider |         | Select the TTS (text-to-speech) service provider to use with the gateway. |
| Phone Number |         | The telephone number that you'll use with the gateway.                    |



</chapter>
<chapter title="Speech Settings Elements" collapsible="true" level="5">

![B03-06_0138-Voice-GW-Basic-Tab-Speech](B03-06_0138-Voice-GW-Basic-Tab-Speech.png){width="900" style="block"}

*The Voice Gateway Basic Tab, Speech Settings Elements*

*Voice Gateway Basic Tab, Speech Settings Elements*

|                             Element                             | Default |                                                                                                                                                                                                                                                                                                                                                                                            Description                                                                                                                                                                                                                                                                                                                                                                                            |
|-----------------------------------------------------------------|---------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Speech Settings                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |||
| Add Headers as Attributes                                       |         | The list of SIP (Session Initiation Protocol) Headers to pass to Amelia as conversation attributes. Sending SIP Headers to Amelia: * The Amelia Voice service sends a comma-separated list of SIP Header names to Amelia as initial attributes. You can find the SIP Header names by watching the fs_cli logs during a call. For example if you have the variable_sip_h_X_Genesys-CallUUID: SIP Header in Freeswitch. The headers_as_attributes variable should show as <action application="set" data="headers_as_attributes=x-genesys-calluuid"/> to pass the header to Amelia. * The header values become readable in the BPN initial conversation attributes map with the key voice_sip_&lt;headerName&gt;. |
| Add Variables as Attributes                                     |         | The list of channel variables to pass to Amelia as conversation attributes. Similar, to headers_as_attributes, but works for all channel variables (not only those prefixed with sip_h). Attribute naming follows the voice_var_&lt;varName&gt; pattern.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| Allow Barge In                                                  | False   | Enabling this setting lets you interrupt Amelia during conversation.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| Amelia Connection Retries                 | 0       | Enter the number of retries to use if the Amelia Voice service fails to connect to Amelia. Increasing this number lets the service try again before taking the error-handling route.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| Answering Machine Detection Silence Threshold                   | 200     | The amount of silence needed to trigger silence detection after AMD (Answering Machine Detection) beep detection. Enter this value in milliseconds.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| Answering Machine Detection Silence Timeout                     | 5,000   | The silence timeout or amount of time allowed for silence after AMD beep detection. Enter this value in milliseconds.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| Answering Machine Detection Timeout                             | 60      | The maximum amount of time allowed for detecting answering machines. Enter this value in seconds.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| Apply SSML tags                                                 | False   | Enabling this wraps the Amelia dialog in SSML (Speech Synthesis Markup Language) tags before requesting speech synthesis. SSML tags help to enhance the quality of the speech output. By default, SSML tags are not applied. Click to enable.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| Custom Verto Gateway                                            |         | The override for the instance's default Verto gateway.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| Default Error Message                                           |         | Enter the error message text that Amelia will communicate verbally during error cases.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| Default Grammar Name                                            | general | Enter the name of the default grammar to use when you have no specific grammar specified in the Ask Task.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| Default SIP URI for Redirect                                    |         | Enter the SIP (Session Initiation Protocol) URI (Uniform Resource Identifier) that Amelia will use during a SIP redirect if no other is set in the BPN (Business process network). You'll use this SIP URI to transfer calls if there's an internal or unexpected error before the call is answered. Format your SIP URI as sip:&lt;extension&gt;@&lt;ip_address&gt;:&lt;port&gt;;transport=&lt;protocol&gt;. The transport is mandatory.                                                                                                                                                                                                                                                                                                                                                           |
| Default SIP URI for Transfer                                    |         | Enter the SIP URI that Amelia will use during a SIP transfer if no other is set in the BPN. You'll use this SIP URI to transfer calls if there's an internal or unexpected error. Format your SIP URI as sip:&lt;extension&gt;@&lt;ip_address&gt;:&lt;port&gt;;transport=&lt;protocol&gt;. The transport is optional.                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| Enable Answering Machine Detection                              | False   | Enables answering machine detection on outbound calls. When enabled, call progress blocks until Amelia determines if a human or machine has answered. If a machine answers, the call will again block until Amelia detects the beep and final degree of silence. If a human answers, Amelia skips beep detection.                                                                                                                                                                                                                                                                                                                                                                                                               |
| Enable Sending Voice Recordings to Amelia | False   | Tells the Voice gateway to send recordings to Amelia for viewing in Amelia's UI.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| Fail on Text to Speech Error                                    | False   | Tells the voice service to fail the call on all text-to-speech errors.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| Grammar Inline Support                                          | False   | If enabled, Amelia includes the grammar inline in the MRCP (Media Resource Control Protocol) request instead of writing it to the disk.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| Grammar Provider ID                                             |         | Enter the ID of your grammar provider (also referred to as stt-admin) associated with the grammars you have in use. You can find your Provider ID by curling <grammar_server_url>/providers endpoint.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| Human Detected Message                                          |         | This string is for use as the first user utterance in the conversation if you have AMD enabled and a human answers.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| Prefetch Grammars                                               | False   | If enabled, Voice service prefetches the grammars rather than giving the URI to the STT provider.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| Release Text to Speech License                                  | False   | Enabling this closes the ASR (answer-seizure ratio) channel after each use, releasing the port and license. Releasing the connection for text-to-speech lessens the load on licenses. This is not compatible with WebRTC agent calling.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| Retain Custom Properties Between Tasks                          | False   | Keeps properties between Ask and Say tasks rather than resetting to default. So, if Amelia re-prompts an Ask task, the custom properties like grammar names aren't sent again. If disabled, the re-prompt uses the Default Grammar Name rather than what's in the Ask task. But if enabled, then the re-prompt uses the same grammar as before. With the feature enabled, using the classifier space, then the grammar will be the most recent grammar used, not the default. Consider your BPN flow and grammar requirements when deciding to use this feature. Click to enable.                                                                                                                                                                                           |
| Send Completion Cause                                           | False   | If enabled, Amelia sends the completion clause instead of "idk" for speech recognition errors. Click to enable.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| Speech to Text Retries                                          | 0       | The number of times to retry speech-to-text if an error occurs.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Unknown Detected Message                                        |         | String used as the first user utterance in the conversation if you have AMD enabled and Amelia can't detect human or machine activity. Use this entry to route your BPN flow as needed.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |



</chapter>

<chapter title="Custom Property Default Value" collapsible="true" level="5">

You can override the following default settings for specific Digital Employees builder or BPN configurations.

![B03-06_0138-Voice-GW-Basic-Tab-Custom](B03-06_0138-Voice-GW-Basic-Tab-Custom.png){width="900" style="block"}

*The Voice Gateway Basic Tab, Custom Property Default Value Settings*

*Voice Gateway Basic Tab, Custom Property Default Value Settings*


|           Element            |        Default         |                        Task Type(s)                        |                                                                                                                                                   Description                                                                                                                                                    |
|------------------------------|------------------------|------------------------------------------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Additional CDR               |                        | CLOSE_THE_CONVERSATION | ESCALATE                          | {% include from="B03-06_0138-Addit-CDR.md" element-id="B03-06_0138-Addit-CDR_snippet" /%}                                                                                                                                                                                                                   |
| Allow DTMF                   | False                  | ASK                                                        | {% include from="B03-06_0138-Allow-DTMF.md" element-id="B03-06_0138-Allow-DTMF_snippet" /%}                                                                                                                                                                                                                 |
| Disable Barge In             | False                  | ASK | SAY                                                  | Enable this if you have barge-in on your extension, and you want to disable it for a set of dialogues. {% include from="B03-06_0138-Disable-Barge-In.md" element-id="B03-06_0138-Disable-Barge-In_snippet" /%} This is useful for cases with adjacent dialogue tasks where you don't want any interruption. |
| Disable Speech to Text       | False                  | ASK                                                        | {% include from="B03-06_0138-Disable-Speech-to-Text.md" element-id="B03-06_0138-Disable-Speech-to-Text_snippet" /%}                                                                                                                                                                                         |
| DTMF Termination Character   |                        | ASK                                                        | {% include from="B03-06_0138-DTMF-Term-Char.md" element-id="B03-06_0138-DTMF-Term-Char_snippet" /%}                                                                                                                                                                                                         |
| DTMF Termination Length      |                        | ASK                                                        | {% include from="B03-06_0138-DTMF-Term-Length.md" element-id="B03-06_0138-DTMF-Term-Length_snippet" /%}                                                                                                                                                                                                     |
| Escalate Silently            | False                  | ESCALATE                                                   | {% include from="B03-06_0138-Escalate-Silently.md" element-id="B03-06_0138-Escalate-Silently_snippet" /%}                                                                                                                                                                                                   |
| Escalation Target            |                        | ESCALATE                                                   | {% include from="B03-06_0138-Escalate-Target.md" element-id="B03-06_0138-Escalate-Target_snippet" /%}                                                                                                                                                                                                       |
| Escalation Type              | REFER                  | ESCALATE                                                   | {% include from="B03-06_0138-Escalate-Type.md" element-id="B03-06_0138-Escalate-Type_snippet" /%}                                                                                                                                                                                                           |
| Grammar Name                 | general                | ASK                                                        | {% include from="B03-06_0138-Grammar-Name.md" element-id="B03-06_0138-Grammar-Name_snippet" /%}                                                                                                                                                                                                             |
| Idle State Audio             | Configured in dialplan | ASK | SCRIPT | RUN_THE_WORKFLOW | RUN_THE_INTEGRATION_FLOW | {% include from="B03-06_0138-Idle-State-Audio.md" element-id="B03-06_0138-Idle-State-Audio_snippet" /%}                                                                                                                                                                                                     |
| Input Priority               | VOICE                  | ASK                                                        | {% include from="B03-06_0138-Input-Priority.md" element-id="B03-06_0138-Input-Priority_snippet" /%}                                                                                                                                                                                                         |
| NLSML Format                 |                        | ASK                                                        | {% include from="B03-06_0138-NLSML-Format.md" element-id="B03-06_0138-NLSML-Format_snippet" /%}                                                                                                                                                                                                             |
| Send as DTMF                 | False                  | ASK | SAY                                                  | {% include from="B03-06_0138-Send-As-DTMF.md" element-id="B03-06_0138-Send-As-DTMF_snippet" /%}                                                                                                                                                                                                             |
| Silence Time Limit           | 5,000                  | ASK                                                        | {% include from="B03-06_0138-Silence-Time-Limit.md" element-id="B03-06_0138-Silence-Time-Limit_snippet" /%}                                                                                                                                                                                                 |
| Sofia Profile for Escalation | Internal               | ESCALATE                                                   | {% include from="B03-06_0138-Sofia Prof-Escalation.md" element-id="B03-06_0138-Sofia Prof-Escalation_snippet" /%}                                                                                                                                                                                           |
| Speech Complete Timeout      | 1,000                  | ASK                                                        | {% include from="B03-06_0138-Speech-Comp-Timeout.md" element-id="B03-06_0138-Speech-Comp-Timeout_snippet" /%}                                                                                                                                                                                               |
| Speech Incomplete Timeout    | 1,000                  | ASK                                                        | {% include from="B03-06_0138-Speech-Incomp-Timeout.md" element-id="B03-06_0138-Speech-Incomp-Timeout_snippet" /%}                                                                                                                                                                                           |
| Speech Time Limit            |                        | ASK                                                        | {% include from="B03-06_0138-Speech-Time-Limit.md" element-id="B03-06_0138-Speech-Time-Limit_snippet" /%}                                                                                                                                                                                                   |
| Speech to Text Engine        |                        | ASK                                                        | {% include from="B03-06_0138-Speech-to-Text-Engine.md" element-id="B03-06_0138-Speech-to-Text-Engine_snippet" /%}                                                                                                                                                                                           |
| Speech to Text Provider      |                        | ASK                                                        | {% include from="B03-06_0138-Speech-to-Text-Prov.md" element-id="B03-06_0138-Speech-to-Text-Prov_snippet" /%}                                                                                                                                                                                               |
| Strip Tags                   | False                  | ASK | SAY                                                  | {% include from="B03-06_0138-Strip-Tags.md" element-id="B03-06_0138-Strip-Tags_snippet" /%}                                                                                                                                                                                                                 |
| Trigger Idle State           | False                  | SCRIPT | RUN_THE_WORKFLOW | RUN_THE_INTEGRATION_FLOW       | {% include from="B03-06_0138-Trigger-Idle-State.md" element-id="B03-06_0138-Trigger-Idle-State_snippet" /%}                                                                                                                                                                                                 |



</chapter>

To add a new Voice gateway:

1. On the Gateway Integrations panel, click + Add New.
2. In the Utility group, click Voice.
3. Inside the New Integration Gateway tab, complete the configuration process based on your individual needs.

