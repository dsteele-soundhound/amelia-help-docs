# How-to: Configure Amelia for Microsoft Teams

## Introduction

The Microsoft Teams gateway lets Amelia interact with Teams and the Azure Bot framework. You create a Teams app and configure it to send and receive messages with Amelia.

## What You'll Learn

In this topic you'll learn how to:

* [Sign up for a Microsoft Teams developer account](#Sign).
* [Create a Microsoft Teams Azure bot](#Create).
* [Create a Microsoft Teams app for the bot](#Create2).
* [Add features like cards to messages](#Microsof).
* [Configure proactive notifications and push conversations](#Proactiv).
* [Add and configure the Microsoft Teams gateway in Amelia](#Configur).

## Requirements

For this gateway configuration, you'll need the following:

* An App ID from creating the Azure bot.
* An App Password, also called a Client Secret in the Azure portal.
* The Messaging Endpoint for Amelia's gateway service.

## Pre-Configuration

Amelia's Microsoft Teams gateway uses Microsoft's Azure Bot Framework REST API to integrate with Microsoft Teams. An MS Teams Azure bot is created and registered in a client Azure account. Then Microsoft Teams is added as a channel for the new Azure bot service. The bot then sends and receives conversation data through Amelia's REST API endpoint.

Once an Azure bot is created and configured, a Microsoft Teams app needs to be created. Microsoft's [MS Teams documentation](https://docs.microsoft.com/en-us/microsoftteams/upload-custom-apps) describes how to create, publish, and control access rights to their custom apps.

Apps for MS Teams are created using Microsoft Teams [Developer Portal](https://dev.teams.microsoft.com/home). Any user with access to Developer Portal can create an app for  Amelia. However, only users with admin rights can publish the app and make it available to others in the organization, as explained in their documentation.

Messages using the Teams gateway and Azure bot can display buttons, multi-line input forms, images, video, and Adaptive Cards.

The following sections will guide you as you complete these steps.

###Sign Up at the Azure Portal {% #Sign %}

The first step is to create an account, or log in to an account, at the Azure Portal. The portal includes a marketplace and other features. It allows you to create and manage Azure services.

To create an Azure Portal account or to log in:

1. Go to [https://portal.azure.com/#home](https://portal.azure.com/#home).
2. Type your email address in the log in box that appears. Press the Enter key.
3. Type your password in the log in box that appears. Press the Enter key.
4. If needed, use the Microsoft Authenticator app to confirm access.

###Create an Azure Bot {% #Create %}

Once you have logged into the Azure Portal, the home page will display.

![B03-06_0121-MSTeams-Azure-Portal](B03-06_0121-MSTeams-Azure-Portal.png){width="900" style="block"}
*Figure 1. Azure Portal Home*


<chapter title="Create a Resource" collapsible="true" level="5">
To create an Azure bot, first create a resource:

1. Click the + Create a Resource link at the center left of the Azure Portal home. The Marketplace will display.
2. Type the search term Azure bot in the search box near the top of the Marketplace page. Press the Enter key. The search results displays rows of blocks.
3. Click the Azure Bot block in the search results page.

![B03-06_0121-MSTeams-Mktplace-AzureBot](B03-06_0121-MSTeams-Mktplace-AzureBot.png){width="900" style="block"}

*Figure 2. Marketplace Search Results with Azure Bot Block*

</chapter>
<chapter title="Configure the Azure Bot" collapsible="true" level="5">
When the Azure Bot page displays, configure the new bot:

1. Type a distinct name for the Bot Handle field. The name can be overridden in the Teams App for users. However, this Bot Handle value will always refer to the bot in the Azure portal.
2. Fill in the Subscription field.
3. Choose or create a Resource Group for the new bot.
4. Do NOT click the Manually Create App ID link. Let the App ID be created automatically.
5. Click the Review + Create button to save the Basics settings.
6. Once the bot review process is validated, click the Create button. The bot Deployment page displays.

![B03-06_0121-MSTeams-BotDeploy](B03-06_0121-MSTeams-BotDeploy.png){width="900" style="block"}

*Figure 3. Azure Bot Deployment Page*

</chapter>
<chapter title="Connect the Azure Bot to a Channel" collapsible="true" level="5">
Once an Azure bot is created, the next step is to assign the bot to a channel.

1. From the bot Deployment page, in Step 6 above, click the Go to Resource button. The bot detail page displays.
2. Click the Channels link on the left of the bot detail page.
3. Click the Teams icon as the featured channel to add. Once the Teams channel is added, it is safe to delete the default Web Chat channel because it's never used.
4. In the Channels page that displays, click the Save button.

![B03-06_0121-MSTeams-BotChannels](B03-06_0121-MSTeams-BotChannels.png){width="900" style="block"}
*Figure 4. Azure Bot Channels Page*

</chapter>
<chapter title="Finish Configuration of the Azure Bot" collapsible="true" level="5">
With the channel assigned to your Azure bot, finish configuration of the Azure bot.

1. Click the Configuration link on the left side of the Configuration page.
2. Add the Messaging Endpoint for the Amelia instance. In the example below, your.amelia.instance should be the publicly accessible host name for the Amelia instance. Enter the rest of the URL as shown below.
3. Highlight the Microsoft App ID value then copy and paste the ID in a safe place. It's used to configure Amelia.

![B03-06_0121-MSTeams-BotConfig](B03-06_0121-MSTeams-BotConfig.png){width="900" style="block"}
*Figure 5. Azure Bot Configuration Page*

</chapter>

<chapter title="Create a New Client Secret" collapsible="true" level="5">
The Client Secret is the next configuration step. The secret is a string used to prove the bot identity when requesting tokens. It also is referred to as an application password.

This is the only opportunity to copy the secret, immediately after it is created. Returning to this page for the secret will require creating a new secret and then updating Amelia with the new secret.

1. From the bot Configuration page, in steps 2 and 3 above, click the Manage link to the right of the Microsoft App ID label. The Certificates & Secrets page displays.
2. Click the New Client Secret link located in the Client Secrets section of the Certificates and Secrets page. An Add a Client Secret pop up appears.
3. Type a Description and select when the secret Expires in the pop up. Make the Expires date far into the future if the secret needs to change periodically. Or make the Expires date never expire.
   > Changing the secret at some future date will require updating the Amelia configuration with the new secret and redeploying.
4. Click the Add button in the Add a Client Secret pop up. The Certificates & Secrets page will display.
5. Click the Copy ( ![Copy-Btn-DEB_Toolbar](Copy-Btn-DEB_Toolbar.png){width="25" style="inline"}) icon to the right of the Value entry in the Client Secrets section of the page. Paste this value in a safe place along with the Microsoft App Id. You'll use the secret and App Id to configure Amelia.

![B03-06_0121-MSTeams-BotSecrets](B03-06_0121-MSTeams-BotSecrets.png){width="900" style="block"}
*Figure 6. Azure Bot Certificates and Secrets Page*

</chapter>

<chapter title="Assign API Permissions" collapsible="true" level="5">
The Azure bot needs API permissions to work with the Amelia gateway. Additional optional permissions can be added for push notifications, as described in the next section. Go to the Azure Active Directory and then select App Registrations for your newly created Teams app. Select the API Permissions link on the left. In the App Permissions page, choose the bot from the list. Then open the Manage sub-menu in the left hand menu.

1. Click the API Permissions link on the left side menu options.. The API Permissions page displays.
2. Click the + Add a Permission link in the Configured Permissions panel on the API Permissions page.
3. Select Microsoft Graph as the API.
4. Click the Application Permissions option.
   > Do NOT click the Delegated Permissions button. Permissions must be Application Permissions.
5. Type User.Read.All in the Select Permissions search box that displays below the Application Permissions option.
6. Click the check box to the left of the User.Read.All permission that displays below the search box.
7. Click the Add Permissions button to save these API settings.
![B03-06_0121-MSTeams-BotReqAPIPerm](B03-06_0121-MSTeams-BotReqAPIPerm.png){width="900" style="block"}

*Figure 7. Azure Bot Request API Permissions Page*

</chapter>

 

#### Optional Bot Push Notification Permissions

These permissions are only required if you intend to use the Push Notifications functionality when configuring the Amelia gateway. (Tim, add link to that section).

If enabling Push Notification support, the permissions to assign depends on how you assign the external ID of the associated Teams App. The external app ID is assigned dynamically or manually. Assigning the external app ID dynamically when creating the app is recommended. Manually updating the app manifest.json file to match the external app ID with the Azure Bot ID is not recommended.

Push notification permissions are added with the Request API Permissions page, as described in the first two steps in the section immediately above.

In the Configured Permissions workspace, the Admin Consent Required column must be set to Yes for all permissions.

![B03-06_0121-MSTeams-BotPushNotifPerm](B03-06_0121-MSTeams-BotPushNotifPerm.png){width="900" style="block"}
*Figure 8. Azure Bot Push Notification Permissions*
<chapter title="External App ID Assigned Dynamically (Recommended)" collapsible="true" level="5">
If the app's external id was generated in the Azure Dev Portal when creating the app, then the API permission settings should use the pattern `TeamsAppInstallation.ReadWriteFor{Recipient}.All` where `{Recipient}` is either User, Team, or Chat depending on who will receive notifications.

|            Permission Setting             |                                                          Description                                                           |
|-------------------------------------------|--------------------------------------------------------------------------------------------------------------------------------|
| AppCatalog.Read.All                       | {% include from="B03-06_0121-MSTeams-Gateway-PushNotif.md" element-id="B03-06_0121-MSTeams-Gateway-PushNotif_snippet" /%} |
| TeamsAppInstallation.ReadWriteForUser.All | Required only when enabling push notifications to individual users.                                                            |
| TeamsAppInstallation.ReadWriteForTeam.All | Required only when enabling push notifications to teams.                                                                       |
| TeamsAppInstallation.ReadWriteForChat.All | Required only when enabling push notifications to group chats.                                                                 |
[Optional Dynamically Assigned Push Notification Permissions]


</chapter>
<chapter title="External App ID Assigned Manually (Not Recommended)" collapsible="true" level="5">
If the app's external id was assigned the same id as the Azure Bot (by manually updating the app manifest.json file), then the API permissions should use the pattern `TeamsAppInstallation.ReadWriteSelfFor{Recipient}.All` where `{Recipient}` is either User, Team, or Chat depending on who will receive notifications.

|              Permission Setting               |                                                          Description                                                           |
|-----------------------------------------------|--------------------------------------------------------------------------------------------------------------------------------|
| AppCatalog.Read.All                           | {% include from="B03-06_0121-MSTeams-Gateway-PushNotif.md" element-id="B03-06_0121-MSTeams-Gateway-PushNotif_snippet" /%} |
| TeamsAppInstallation.ReadWriteSelfForUser.All | Required only when enabling push notifications to individual users.                                                            |
| TeamsAppInstallation.ReadWriteSelfForTeam.All | Required only when enabling push notifications to teams.                                                                       |
| TeamsAppInstallation.ReadWriteSelfForChat.All | Required only when enabling push notifications to group chats.                                                                 |
[Optional Manually Assigned Push Notification Permissions]


</chapter>

 

#### Test the Connection to Amelia

Once the bot is created and the Amelia gateway configured, you can test its connection to Amelia. Find the bot using the bot App ID. Then in the bot type any question for Amelia to answer.

#### Release and Deploy the Teams Bot

Until your Teams application for your bot is created and deployed, the bot App ID is the only way to find it. These Microsoft links describe how to release and deploy your bot as a new app in Teams.

Administrator privileges in Teams are required to deploy apps for an organization.

* [https://docs.microsoft.com/en-us/MicrosoftTeams/manage-apps](https://docs.microsoft.com/en-us/MicrosoftTeams/manage-apps)

* [https://docs.microsoft.com/en-us/microsoftteams/platform/concepts/build-and-test/app-studio-overview](https://docs.microsoft.com/en-us/microsoftteams/platform/concepts/build-and-test/app-studio-overview)

* [https://docs.microsoft.com/en-us/microsoftteams/enable-features-office-365](https://docs.microsoft.com/en-us/microsoftteams/enable-features-office-365)

#### Configure OAuth Connections (Optional)

Amelia uses OAuth connections to get user tokens for delegated permissions. This allows API calls on behalf of a Teams user. You configure OAuth connections in Azure. Then attach them to the Azure bot connecting to the Amelia gateway. You will need a separate OAuth connection for each external system that needs a user token for API calls.

When Amelia requests an OAuth token, the user must fill in a login prompt. Their login details authenticate them. A successful login grants permission for Amelia to make API calls on behalf of their logged in account.

Once logged in, Amelia does not request another login when making token requests. The login prompt will display in these situations:

* Logging out will trigger a new login request. Passing the Logout Command OAuth property tells Amelia to cancel the connection.

* Revoking permissions through Azure or Teams also triggers a new login request.

* The OAuth connection includes new permissions for the user to grant.

You can add Azure OAuth connections to your bot. Go to Settings and then use the Configuration workspace.

You can find Microsoft documentation about Azure authentication here: [https://learn.microsoft.com/en-us/azure/bot-service/bot-builder-authentication-basics?view=azure-bot-service-4.0](https://learn.microsoft.com/en-us/azure/bot-service/bot-builder-authentication-basics?view=azure-bot-service-4.0)

Microsoft Azure documentation about OAuth connections is here: [https://learn.microsoft.com/en-us/azure/bot-service/bot-builder-concept-authentication?view=azure-bot-service-4.0](https://learn.microsoft.com/en-us/azure/bot-service/bot-builder-concept-authentication?view=azure-bot-service-4.0)

 
<chapter title="Request an OAuth User Token from a Builder Flow" collapsible="true" level="5">
BPN processes and Builder flows send integration messages to request user tokens. If the user grants a token, Amelia sets the token as a conversation attribute. Any task or block in a conversation flow can request a token. For example, a greeting block might use a token to identify the user. Or a Script block needing to make an API call may request a user token. If the token is not available as a conversation attribute, Amelia sends an OAuth request.

Gateway responses to token requests are asynchronous. The conversation flow must wait for the delivery of a token. The flow first checks for a conversation attribute with a user token. If a token attribute exists, the flow should delete it before requesting a token. Response times for token requests depend largely on prompting users to log in. If a user has already granted access, Azure returns the token without prompting the user.

Response time for user log ins depends on user actions. For example, a user may never log in with no token delivered to  Amelia. And if a token request generates an error, the gateway won't respond. A BPN process or Builder flow must account for these use cases in their conversation flows.

</chapter>
<chapter title="Integration Messages" collapsible="true" level="5">
OAuth-related integration messages use one or more fields in messages sent to and from Azure.

|           Field            |                                                                                                                                        Description                                                                                                                                         |
|----------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| action                     | Required. Specifies a token request. Must be set to TokenRequest which is case insensitive.                                                                                                                                                                                                |
| payload                    | Required. Message payload.                                                                                                                                                                                                                                                                 |
| payload.src                | Required. Token request details.                                                                                                                                                                                                                                                           |
| payload.src.connectionName | Required. The name of the OAuth connection used to obtain the user's token. Must match the connection name OR the alias name for the OAuth connection to use from the configuration. These are set in the Basic tab of the Amelia Microsoft Teams gateway workspace. |
| payload.src.loginText      | Required. Text used to prompt the user to login and grant permissions to Amelia. User will not be prompted if they have already given permission for this connection.                                                                                                |
| payload.src.buttonText     | Required. Title of the button in the log in prompt. User will not be prompted if they have already given permission for this connection.                                                                                                                                                   |
| payload.src.returnAttibute | Optional. The name of the conversation attribute that will be set when the token is delivered to  Amelia. If this field is not present in the src object, the returnAttribute and the resulting conversation attribute will be set to the value of the connectionName field.                |
[OAuth Integration Message Fields]

Basic Integration Format

This script shows an integration message format. A BPN Script task or Builder Script block will use this message format to request a specific user token.

The Amelia gateway sets attributes after Azure processes this message with permission granted. The conversation attribute is set to the returnAttribute field value. In this example, graphApiToken is the returnAttribute field.
<code-block lang="JavaScript">
import groovy.json.JsonOutput def jsonString = '''{ "action": "TokenRequest", "payload": { "src": { "connectionName": "OAuthConnection1", "loginText": "Please click the button below to allow me to access your user information in Azure AD.", "buttonText": "Grant Access", "returnAttribute": "graphApiToken" } } }'''; jsonString = JsonOutput.toJson(jsonString); execution.setVariable("tokenRequest", jsonString);
</code-block>

Alternate Message Format: Use an Alias

When configuring the Amelia gateway, you can set the connectionName field to the actual connection name or the alias. Using the alias might make the BPN Script task Builder Script block code more intuitive to read.
<code-block lang="JavaScript">
import groovy.json.JsonOutput def jsonString = '''{ "action": "TokenRequest", "payload": { "src": { "connectionName": "graphApiToken", "loginText": "Please click the button below to allow me to access your user information in Azure AD.", "buttonText": "Grant Access", "returnAttribute": "graphApiToken" } } }'''; jsonString = JsonOutput.toJson(jsonString); execution.setVariable("tokenRequest", jsonString);
</code-block>

Alternate Message Format: Use Alias as Return Attribute and Conversation Attribute Name

When configuring the Amelia gateway, the returnAttribute field is optional. If empty, the returnAttribute and conversation attribute equal the connectionName value.

Use an alias for connectionName and drop the returnAttribute line from the message. The conversation attribute name becomes the connection alias name.

This code is the most concise version of a TokenRequest message.

The Amelia gateway sets attributes after Azure processes this message with permission granted. The conversation attribute is set to the connectionName field value. In this example, graphApiToken is the connectionName field.
<code-block lang="JavaScript">
import groovy.json.JsonOutput def jsonString = '''{ "action": "TokenRequest", "payload": { "src": { "connectionName": "graphApiToken", "loginText": "Please click the button below to allow me to access your user information in Azure AD.", "buttonText": "Grant Access" } } }'''; jsonString = JsonOutput.toJson(jsonString); execution.setVariable("tokenRequest", jsonString);
</code-block>
</chapter>


###Create a Microsoft Teams App {% #Create2 %}

You can create a Microsoft Teams app once an Azure bot is created. Note the bot App ID before you create the Teams app.
1. Go to the Teams Developer Portal: [https://dev.teams.microsoft.com/home](https://dev.teams.microsoft.com/home).
2. Click the Apps link on the left side of the portal to display the Apps page.
3. Click the + New App button at the top of the page. Or click the Create your first app button in the middle of the page.
4. Type a unique name for the app in the Add App pop up that displays. Click the Add button to create the app.
5. Complete the Basic Information form to configure the Teams app.
   * If you use push notifications, the Teams App ID is the Teams App External ID setting used when configuring the Amelia gateway.
   * The Application (client) ID is the Azure bot Application Id.
6. Click the Branding link on the left. Add an icon and configure color as appropriate.
7. Click the App Features link on the left. Click the Bot feature to add the bot. Then click the Enter a bot ID setting and add the Azure bot ID to the app. Specify the actions and scope for the bot:
   * The Support audio calls and Support video calls settings are not supported.
   * The Only send notifications (one-way conversations) setting would only allow Push Notifications to be sent from Amelia, but, it would not allow users to have a conversation with Amelia.
8. Click the Single Sign-On link on the left. Whether or not SSO is used, type this in the Application ID URI field: `api://{application-id}` where `{application-id}` is the Azure bot Application ID.
9. Click the Publish to Org link on the left. Then click the Publish your app button in the center of the page.
   Your app will be submitted for publishing to your organization app catalog. A Teams admin user must then approve and publish the app through the Microsft Teams admin center (out of scope for this documentation).

###Microsoft Teams Features {% #Microsof %}

Messages using the Teams gateway and Azure bot can display buttons, multi-line input forms, images, video, and Adaptive Cards. The Microsoft documentation shows how to use these features. Note to Tim: These features should reflect what Amelia can send to Teams via BPNs. These features are shown here: https://dtools.ipsoft.com/confluence/pages/viewpage.action?pageId=187254473

###Proactive Notifications and Push Conversations {% #Proactiv %}

The gateway and Amelia include the ability to send push notifications and conversations to users in MS Teams.

#### The Notification API

Note to Tim: Perhaps all of this info below regarding push notifications should be in its own section with a link to it from here. The same goes for the Twilio gateway, which also supports push notifications. Here is the information for such a page:  

https://dtools.ipsoft.com/confluence/pages/viewpage.action?pageId=187255568#PushNotificationsandPushConversationsThroughChatGateways(V5)-PushNotificationPayloadsandAttributes


That page not only describes how to send notifications using the REST gateway, but also the Amelia SDK, which some client's use. I think this would make things simpler to read and maintain.


Only authenticated users in Amelia can send a proactive message to an end user in Teams. The authenticated user's account must have the AUTHORITY_NOTIFICATION_PUSH authority assigned to their Amelia user account

The intended MS Teams gateway must be enabled, deployed, and configured for push notifications. Otherwise, an error message will occur when using the Notification API. Amelia's REST gateway exposes the Notification API to (authenticated) end users wishing to send push notifications and/or conversations to users in Teams.

|       Element        | Description                                                                                                                                                                                                                                  |
|----------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Endpoint             | POST /AmeliaRest/api/v1/push/notification/`{gatewayIntegrationId}`                                                                                                                                                                           |
| gatewayIntegrationId | The unique ID for the MS Teams gateway integration which will handle the request, for example: `f3430d11-fea8-4dcf-9eea-e4b271cd0190` This ID is the integration ID displayed on the gateway integration workspace in Amelia's admin UI..    |
| JSON Payload         | JSON payload which includes the message to the recipient along with required attributes necessary to send the message.<code-block> { "message": "The message to send", "pushAttributes": { // endpoint specific attributes } } </code-block> |
[REST Gateway Notification Details]

#### Push Notification Payloads and Attributes

The Amelia REST gateway push notification payload supports two message types.

| Payload Type |                                                Description                                                |
|--------------|-----------------------------------------------------------------------------------------------------------|
| Text         | This message type supports plain text, markdown, and XML.                                                 |
| JSON         | This message type supports Adaptive Cards, Hero Cards, and other card types supported by Microsoft Teams. |
[REST Gateway Message Payload Types]

The REST gateway push notification payloads support multiple attributes. Attributes are case sensitive.

|      Attribute      |                                                                                                                                                 Description                                                                                                                                                 |
|---------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Recipient Attributes for Users, Teams, and Group Chats                                                                                                                                                                                                                                                                           ||
| format              | Specify the message format. Options are text and json. Text is default.                                                                                                                                                                                                                                     |
| textFormat          | Specify the format used for text messages. Options are plain, markdown, and xml. Default is plain.                                                                                                                                                                                                          |
| notification        | Specify whether notification is true or false. True will generate an alert in the user's Activity feed.                                                                                                                                                                                                     |
| Recipient Attributes for Users                                                                                                                                                                                                                                                                                                   ||
| uid or upn or email | Identify the user. Options are the user's object ID (uid) in Azure AD, the User Principal Name (upn) in Azure AD, or email address. The email address is deprecated. The uid supersedes all other attributes. It can be used to indicate the user's AAD object ID, the user profile name, or email address. |
| Recipient Attributes for Teams                                                                                                                                                                                                                                                                                                   ||
| groupId             | Required. Specify the group ID identifying the Team. It can be found in the Team link.                                                                                                                                                                                                                      |
| teamId              | Required. Specify the ID of the Team Channel. It can be found in the Team Link or the General Channel link for the Team.                                                                                                                                                                                    |
| channel             | Optional. Specify the ID of the channel in the Team. It can be found in the Channel link. If this attribute is not included in the attributes, the General channel for the Team will be used.                                                                                                               |
| Recipient Attributes for Group Chats                                                                                                                                                                                                                                                                                             ||
| groupChatId         | Required. Specify the chat id of the group conversation. It can be found in the address bar when selecting a group chat from a browser session. It cannot be found with a desktop client.                                                                                                                   |
[REST Gateway Message Payload Attributes]

 

##Configure Amelia {% #Configur %}

After pre-configuration, you're ready to set the new gateway integration to interact with Amelia.

### Add a Microsoft TeamsGateway

To do this:

1. From the **top left main** menu, click Digital Employees.

2. On the **left-side** menu, click Integrations. The Gateway Integrations panel opens between the left-side menu and the Home page.

3. In the Gateway Integrations panel, click + Add New.

4. From the Conversation Gateways group, click Microsoft Teams.

#### Configure the Basic Tab

Open the following dropdown to learn about Basic tab elements.
<chapter title="Basic Tab Elements" collapsible="true" level="5">
Use this section to connect Amelia and your Microsoft Teams account.

![B03-06_0121-MSTeams-Basic](B03-06_0121-MSTeams-Basic.png){width="900" style="block"}

*Figure 9. New Webex Teams Chat Integration Showing Basic Tab*

|           Element           |                              Default                              |                                                                                                                                                                                                                                                         Description                                                                                                                                                                                                                                                         |
|-----------------------------|-------------------------------------------------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Name                        |                                                                   | {% include from="B03-06_GateCom-Name.md" element-id="B03-06_GateCom-Name_snippet" /%}                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| Domain                      |                                                                   | {% include from="B03-06_GateCom-Domain.md" element-id="B03-06_GateCom-Domain_snippet" /%}                                                                                                                                                                                                                                                                                                                                                                                                                              |
| Gateway Service             |                                                                   | {% include from="B03-06_GateCom-GateSrv.md" element-id="B03-06_GateCom-GateSrv_snippet" /%}                                                                                                                                                                                                                                                                                                                                                                                                                            |
| Deploy                      | No                                                                | {% include from="B03-06_GateCom-Deploy.md" element-id="B03-06_GateCom-Deploy_snippet" /%}                                                                                                                                                                                                                                                                                                                                                                                                                              |
| Configuration Locale        |                                                                   | {% include from="B03-06_GateCom-ConfigLocale.md" element-id="B03-06_GateCom-ConfigLocale_snippet" /%}                                                                                                                                                                                                                                                                                                                                                                                                                  |
| Configuration                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |||
| Application ID              |                                                                   | Type the Microsoft Teams Application ID from the bot configuration page in the Azure portal.                                                                                                                                                                                                                                                                                                                                                                                                                                |
| Application Password        |                                                                   | Type the Microsoft Teams Password, called the Client Secret in the Azure portal.                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| Authentication Base URL     | https://login.microsoftonline.com                                 | Pre-populated. Base URL for Microsoft Teams authentication.Do not change these values unless directed to do so.                                                                                                                                                                                                                                                                                                                                                                                                             |
| Authentication Service Path | /botframework.com/oauth2/v2.0/token                               | Pre-populated. Authenticated Service URL Path. Do not change these values unless directed to do so. Service path to authenticate the gateway with Azure Bot Services. Default:`/botframework.com/oauth2/v2.0/token` Single Tenant:`/{tenantId}/oauth2/v2.0/token` If you created a Multi Tenant Azure Bot, leave the default value. If you created a Single Tenant Azure Bot, replace the path segment, botframework.com, with the tenant id from Azure. Example: `/06c0502c-4f01-11ed-bdc3-0242ac120002/oauth2/v2.0/token` |
| OAuth Scope                 | https://api.botframework.com/.default                             | Pre-populated. OAuth Scope URL.Do not change these values unless directed to do so.                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| API Grant Type              | client_credentials                                                | Pre-Populated. API Grant Type for authentication.Do not change these values unless directed to do so.                                                                                                                                                                                                                                                                                                                                                                                                                       |
| Open ID Metadata URL        | https://login.botframework.com/v1/.well-known/openidconfiguration | Pre-Populated. Open ID Metadata URL.Do not change these values unless directed to do so.                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| OAuth URL                   | https://api.botframework.com                                      | Pre-Populated. OAuth URL.Do not change these values unless directed to do so.                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| Token Issue URL             | https://api.botframework.com                                      | Pre-Populated. Token Issuer URL. Do not change these values unless directed to do so.                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| Tenant ID                   |                                                                   | Type the tenant ID of the Azure tenant. The Tenant ID can be found in the Azure portal.                                                                                                                                                                                                                                                                                                                                                                                                                                     |
[New Webex Teams Chat Integration Basic Tab Elements]

</chapter>

#### Configure the Configuration Tab

The Configuration tab settings define how the gateway will behave, for example, in a conversation restart. Open the following dropdown to learn about Configuration tab elements.
<chapter title="Configuration Tab Elements" collapsible="true" level="5">
The table that follows shows each element, it's defaults and a short description of the setting's behavior. This information will help you further customize your Amelia gateway instance.

![B03-06_0121-MSTeams-Config](B03-06_0121-MSTeams-Config.png){width="900" style="block"}

*Figure 10. Configuration Tab*

|                                  Element                                   |                       Default                        |                                                                                                                                                                                                                                                                                                                                                                                                                                                                             Description                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
|----------------------------------------------------------------------------|------------------------------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Channel                                                                    | msteams                                              | {% include from="B03-06_GateCom-Channel.md" element-id="B03-06_GateCom-Channel_snippet" /%}                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| Amelia Conversation Request Timeout (seconds)                              | 30                                                   | {% include from="B03-06_GateCom-ConvReqTimeout.md" element-id="B03-06_GateCom-ConvReqTimeout_snippet" /%}                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| Authenticated Users                                                        | No                                                   | {% include from="B03-06_GateCom-AuthUsers.md" element-id="B03-06_GateCom-AuthUsers_snippet" /%}                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| Suppress Amelia's First Utterance                                          | Yes                                                  | {% include from="B03-06_GateCom-SuppressFirstUtter.md" element-id="B03-06_GateCom-SuppressFirstUtter_snippet" /%}                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| Support Present Content                                                    | Yes                                                  | {% include from="B03-06_GateCom-SupportPresent.md" element-id="B03-06_GateCom-SupportPresent_snippet" /%}                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| Chat Settings                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |||
| Enable Chat Timeout                                                        | Yes                                                  | {% include from="B03-06_GateCom-EnableChatTO.md" element-id="B03-06_GateCom-EnableChatTO_snippet" /%}                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| Chat Timeout Seconds                                                       | 900                                                  | {% include from="B03-06_GateCom-ChatTOSeconds.md" element-id="B03-06_GateCom-ChatTOSeconds_snippet" /%}                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| Enable Chat Timeout Message                                                | Yes                                                  | {% include from="B03-06_GateCom-EnableChatTOMsg.md" element-id="B03-06_GateCom-EnableChatTOMsg_snippet" /%}                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| Chat Timeout Message                                                       | This conversation has been closed due to inactivity. | {% include from="B03-06_GateCom-ChatTOMsg.md" element-id="B03-06_GateCom-ChatTOMsg_snippet" /%}                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| Conversation Settings                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |||
| Enable Close Conversation on User Message                                  | Yes                                                  | {% include from="B03-06_GateCom-EnableCloseConv.md" element-id="B03-06_GateCom-EnableCloseConv_snippet" /%}                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| User Close Conversation Message                                            | /close                                               | {% include from="B03-06_GateCom-UserCloseConvMsg.md" element-id="B03-06_GateCom-UserCloseConvMsg_snippet" /%}                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| Enable Conversation Restart on User Message                                | Yes                                                  | {% include from="B03-06_GateCom-EnableConvRestart.md" element-id="B03-06_GateCom-EnableConvRestart_snippet" /%}                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| User Restart Conversation Message                                          | /restart                                             | {% include from="B03-06_GateCom-UserRestartConvMsg.md" element-id="B03-06_GateCom-UserRestartConvMsg_snippet" /%}                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| Enable Chat Closed Message                                                 | Yes                                                  | {% include from="B03-06_GateCom-EnableChatClosedMsg.md" element-id="B03-06_GateCom-EnableChatClosedMsg_snippet" /%}                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| Chat Closed Message                                                        | This conversation has been closed.                   | {% include from="B03-06_GateCom-ChatClosedMsg.md" element-id="B03-06_GateCom-ChatClosedMsg_snippet" /%}                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| Add User Information to Initial Conversation Attributes                    | No                                                   | {% include from="B03-06_GateCom-AddUserInfoAttr.md" element-id="B03-06_GateCom-AddUserInfoAttr_snippet" /%}                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| User First Name Attribute                                                  | userFirstName                                        | {% include from="B03-06_GateCom-UserFNameAttr.md" element-id="B03-06_GateCom-UserFNameAttr_snippet" /%}                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| User Last Name Attribute                                                   | userLastName                                         | {% include from="B03-06_GateCom-UserLNameAttr.md" element-id="B03-06_GateCom-UserLNameAttr_snippet" /%}                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| User Email Attribute                                                       | userEmail                                            | {% include from="B03-06_GateCom-UserEmailAttr.md" element-id="B03-06_GateCom-UserEmailAttr_snippet" /%}                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| User External Uid Attribute                                                | userExernalUid                                       | {% include from="B03-06_GateCom-UserIDAttr.md" element-id="B03-06_GateCom-UserIDAttr_snippet" /%}                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| Enable Push Conversations                                                  | No                                                   | {% include from="B03-06_GateCom-PushConv.md" element-id="B03-06_GateCom-PushConv_snippet" /%}                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| Enable Push Notifications                                                  | No                                                   | {% include from="B03-06_GateCom-PushNotice.md" element-id="B03-06_GateCom-PushNotice_snippet" /%}                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| Tenant ID                                                                  |                                                      | If either Enable Push Conversations or Enable Push Notifications is/are toggled on, type the tenant ID of the Azure tenant. The Tenant ID can be found in the Azure portal.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| Teams App External ID                                                      |                                                      | External ID of the associated Teams app published for the integration. If either Push Conversation or Push Notifications are enabled, the Teams app External ID is required. The External Id can be found in the Microsoft Teams Admin Center.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| Push Token Time to Live (days)                                             | 30                                                   | The number of days that tokens obtained from Teams for push notifications will be cached by Amelia, after which the tokens are discarded. Default is 30 days. Minimum setting is 1. If either Push Conversations or Push Notifications are enabled, the gateway will cache the necessary tokens needed to send push notifications to users in Teams. These tokens will be cached for the number of days specified with this property. Once a token is removed, a new token will be obtained on the next push notification attempt or through the user's normal interaction with Amelia through the gateway.                                                                                                                                                                                                                                                                                                                                                         |
| Download Team Members When Adding Amelia Teams App to a Team or Group Chat | Yes                                                  | Enables/Disables the feature that will download and cache user tokens from a team or group chat. These tokens can then be used for subsequent push notifications to these users. This feature allows user tokens to be cached without requiring the users to have a previous conversation with Amelia (having a conversation also caches the user's tokens). Default is Yes. Only enabled for selection if one or both of the Push options are enabled. If enabled, user tokens will be downloaded from Azure when the Amelia MS Teams App associated with the integration is first installed into the team or group chat. Profile information downloaded is limited to the user's name, email address and channel ids necessary to send push notifications. Caching a team roster can be time consuming if the number of users on the team or group is very large. Care should be taken when using this property with very large teams (several hundred+ members). |
[Configuration Tab Elements]


</chapter>


#### Configure the Additional Properties Tab

The Additional Properties tab settings define how the gateway will behave, for example, in a conversation restart. Open the following dropdown to learn about Additional Properties tab elements.

<chapter title="The Additional Properties Tab" collapsible="true" level="5">

The table that follows shows each element, it's defaults and a short description of the setting's behavior. This information will help you further customize your Amelia gateway instance.

![B03-06_0121-MSTeams-Addtl](B03-06_0121-MSTeams-Addtl.png){width="900" style="block"}
*Figure 11. Additional Properties Tab*

| Element                                                                   | Default                                         | Description                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
|---------------------------------------------------------------------------|-------------------------------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Use Teams Locale Setting for New Conversations                            | Enabled                                         | Toggle to enable or disable this feature. Default is Enabled. If enabled, the gateway will start conversations with Amelia using the user's language setting from the Microsoft Teams client. If translation is enabled in Amelia, Amelia will respond in this language set by this locale. If disabled, no locale information is sent to Amelia when starting conversations.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| Group and Team Chat                                                       | Enabled                                         | Toggle to enable or disable group and team chats. An MS Teams app can be added to teams and/or group chats. Once added to a team or group chat, a user in the chat could ask Amelia a question by @mentioning the app by name. Once the app is created and installed into the app directory for the organization, it can be added for personal use, groups, or teams chats. For personal one-to-one conversations there is no need to @mention the app; start a conversation by typing in the chat window. For groups and teams, @mention the app by name in order to have Amelia respond. In a group or team chat, the first person in the group or team that @mentions Amelia will be identified as the user that starts the conversation. The transcript will only show the first person to @mention  Amelia. Other mentions will be noted in the transcript as the first person, not other members of the group or team. The transcript will not indicate multiple people were in the conversation. If the Enable Close Conversation on User Message setting is toggled on in the configuration of Amelia Teams gateway, in the Properties tab, anyone in a group or team can close a conversation with the /close command, or what is configured in the User Close Conversation Message setting in the Properties tab. An initial conversation attribute isGroupChat is passed to Amelia when starting the conversation to indicate whether or not the conversation is with a group, team, or an individual. BPNs can use this attribute when responding to the group or individual user. |
| Swap First and Last Name on User Creation                                 | No                                              | If enabled, the user's first and last name will be swapped in Amelia when requesting a conversation. If user auto-creation in Amelia is enabled as well, the user's first and last name will be swapped in their created profile. This feature would be useful if, for example, the user's first and last name in Azure AD in Teams were reversed for some reason.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| Escalation Started Message                                                | Enabled                                         | Toggle to enable or disable Amelia sending a message when a conversation is escalated.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| Agent Transfer Message                                                    | Enabled                                         | Toggle to enable or disable Amelia sending a message when Amelia transfers a conversation or an agent handling an escalation transfers the escalation to another agent.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| Enable Routing Error Message                                              | Yes                                             | Toggle to enable or disable Amelia sending a message back when routing a user message generates an error.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| Routing Error Message                                                     | There was an error routing your message         | If Enable Routing Error Message is toggled on, type the message to send when routing a user message generates an error. The default message is, "There was an error routing your message."                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| Enable Present Error Message                                              | Yes                                             | Toggle to enable or disable Amelia sending a message when content to be presented cannot be displayed in a conversation.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| Present Error Message                                                     | There was an error presenting the file          | If Enable Present Error Message is toggled on, type the error message for Amelia to send. The default is, "There was an error presenting the file."                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| Enable Form Echo                                                          | Yes                                             | Toggle to enable or disable Amelia displaying submitted form values in a conversation. This setting is useful for troubleshooting purposes and should be disabled in a production environment.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| Form Echo Message                                                         | The following value(s) have been selected:      | If Enable Form Echo is toggled on, type the message to display above the echoed form values. The default message is, "The following value(s) have been selected:"                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| Delete Form on Submit                                                     | Yes                                             | Toggle to enable or disable the deletion of a chat window form in a conversation when the form is submitted by the user.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| Default File Upload Description                                           | File from Amelia                                | Type a description to include with the file upload from Amelia to MS Teams. Used only if the metadata for the file sent from Amelia does not contain a description. Default description is, "File from Amelia".                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| File Upload Declined Message                                              | File upload declined                            | Used as the message sent back to the user if they decline a file upload from  Amelia. Default is, "File upload declined".                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| Conversation Start Error Message                                          | An error has occurred starting the conversation | Used as the message Amelia sends to the user if an error occurs at the start of a conversation. Default is, "An error has occurred starting the conversation."                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| **OAuth Connections**                                                     |                                                 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| Enforce User Login (requires OAuth Connection configured in Azure)        | No                                              | Toggle on or off the ability to enforce user login to speak with  Amelia. If toggled on, OAuth connection settings must be configured. If enabled, the gateway will request the user token for the OAuth connection specified by the OAuth Connection Name before starting a conversation with  Amelia. If the user is authenticated and grants permission, the user's token will be created as an initial conversation attribute in Amelia when the conversation starts.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| OAUTH Connection Name (must match name configured in Azure)               |                                                 | The name of the OAuth connection to request the user's token. This MUST match the OAuth Connection Name as specified in Azure. **The name is case sensitive.**                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| User token Attribute (initial conversation attribute to save user token   | userToken                                       | The conversation variable to hold the unique user token. userToken is the default.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| Login Button Title                                                        | Sign in                                         | Define the label for the login button. "Sign In" is the default.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| OAuth Card Text                                                           | Please sign in                                  | Define the text to prompt the user to login. "Please sign in" is the default.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| Login Timeout in seconds (OAuth card is removed from Teams after timeout) | 60                                              | Specifies how many seconds the login prompt should be displayed in Teams to allow the user to login. After the timeout period, the prompt is removed (at which point the user will have to type another message to Amelia to be prompted again). Default: 60 seconds Minimum allowed: 30 seconds Maximum allowed: 300 seconds (5 minutes)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| Logout Command (sent by the user to logout of ALL OAuth connections)      | /logout                                         | The command to use to log out of the session. /logout is the default.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| Logged Out Message (sent to the user after a successful logout)           | You have been logged out                        | The message Amelia sends upon logout. "You have been logged out" is the default.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| **OAuth Connections**                                                     |                                                 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| + Add OAuth Connection button                                             |                                                 | Click to add additional OAuth Connections to Request User Tokens from Builder flows and BPN processes. Amelia can use these tokens to call external APIs on-behalf-of the user in MS Teams.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Connection Name                                                           |                                                 | The name of the OAuth connection to request the user's token. This MUST match the OAuth Connection Name as specified in Azure (this is case sensitive). ALL connection names MUST be unique from ALL other connection names AND aliases. This includes the OAuth Connection Name specified for conversation start, if enabled. Amelia can request the user's token associated with this OAuth connection by sending an integration message to the gateway as described on the Create a Microsoft Teams Azure Bot page. The login card text, button title and returned attribute name are specified in the integration message.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| Connection Alias                                                          |                                                 | An alias name in Amelia for the OAuth connection name. This value can be used by a BPN to request the token rather than the connection name. ALL aliases MUST be unique from ALL other connection names AND aliases. This includes the OAuth Connection Name specified for conversation start, if enabled. The OAuth Connection Name MUST match (case sensitive) the configured connection name in Azure. This name is typically set by an Azure admin and may not be as descriptive as a BPN designer would like. Thus, this descriptive alias can be used by the BPNs rather than the connection name. Examples: CONNECTION NAME ALIAS OAuthConnection1 graphApiToken OAuthConnection2 snowflakeApiToken OAuthConnection3 workdayApiToken The Create a Microsoft Teams Azure Bot page describes how to request the user token from a BPN process.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
[Additional Properties Tab Elements]


</chapter>

## More Resources

To read about other gateways that you can use with Amelia, see:

* Gateway Library Introduction
* Gateway Integrations Introduction
* Gateway Integrations Management
