# How-to: Configure Amelia for ServiceNow Virtual Agent

## Introduction

The ServiceNow Virtual Agent framework allows you to create virtual agents. These agents can connect with  Amelia. User utterances are sent into Amelia's ServiceNow Virtual Agent gateway. Amelia then responds back using the gateway.

ServiceNow topics drive interactions with  Amelia. An end user chooses a topic in the virtual agent. Topics focus on a single subject. They also include a defined process flow. If Amelia cannot handle a conversation, the topic process flow might escalate to an agent.

Amelia also responds with free form integrations. Builder flows and BPN processes manage these integrations. The ServiceNow topic understands the message format. Then takes one or more actions based on the message. In this way, a Builder flow or BPN process can guide the topic flow.

## What You'll Learn

In this topic you'll learn how to:

* [How to set up ServiceNow Virtual Agent](#How).

* [How to create ServiceNow topics](#How2).

* [Integrate ServiceNow topic flows with Amelia](#Integrat).

* [Add and configure the ServiceNow Virtual Agent gateway in Amelia](#Configur).

## Requirements

For this gateway configuration, you'll need the following:

* ServiceNow App ID

* ServiceNow App Secret

* ServiceNow Signature Algorithm

* The Messaging Endpoint for Amelia's gateway service.

## Pre-Configuration

Connecting to the Amelia ServiceNow Virtual Agent gateway requires several steps. You will need to set up a virtual agent, create one or more topics, and define a topic flow. If you need a free form integration, you also will need to create a Builder flow or BPN process. This will manage the integration.

###How to set up ServiceNow Virtual Agent {% #How %}

This topic assumes that you have used the ServiceNow Virtual Agent framework to create a virtual agent. If a virtual agent is not set up, here are useful links to refer to help create them:

Virtual Agent setup in ServiceNow Part 1

[https://www.youtube.com/watch?v=4gER846HJ10](https://www.youtube.com/watch?v=4gER846HJ10)

Virtual Agent setup in ServiceNow Part 2 (second Edition)

[https://www.youtube.com/watch?v=YZvCJahzZ7k](https://www.youtube.com/watch?v=YZvCJahzZ7k)

How to get started with ServiceNow Virtual Agent | Rome Release

[https://www.youtube.com/watch?v=bzN1Z_dqjqI](https://www.youtube.com/watch?v=bzN1Z_dqjqI)

Once you use the ServiceNow Virtual Agent framework to set up a virtual agent, the agent icon will display on the lower right corner of the Service Portal page.

To set up agent chat, please refer to this video:

Workspace Agent Chat Setup Steps

[https://www.youtube.com/watch?v=jc7FyaFz6Cw](https://www.youtube.com/watch?v=jc7FyaFz6Cw)

###How to create ServiceNow topics {% #How2 %}

Topics help organize conversations with Amelia around specific subjects. Topics also are client-specific. In conversation with Amelia, a client can select one or more topics. Users select published topics in their chat window.

In Service Now, you create topics with the Flow Designer tool. The Flow Designer is a robust and flexible no-code diagramming tool. To use it, navigate to Collaboration > Virtual Agent > Designer in ServiceNow.

###Integrate ServiceNow topic flows with Amelia {% #Integrat %}

The topics, examples, and code below are samples. They are for discussion only. They are not production ready.

A ServiceNow Virtual Agent sends user utterances to the Amelia gateway service. The service uses an API end point to receive and process data from ServiceNow.

#### API Endpoint

The ServiceNow Virtual Agent topic sends an outbound HTTP POST request to this endpoint:

`https://&lt;hostname&gt;/Amelia/gateway/service/snowva/&lt;appId&gt;/api/messages`

where&lt;hostname&gt; is the host name of the Amelia instance to receive and process messages. And &lt;appId&gt; is the application ID from the ServiceNow virtual agent configuration process. The appId and appSecret can be any pair of credentials. They need to be the same in both the ServiceNow and Amelia configurations.

#### Authentication

ServiceNow Virtual Agent topics authenticate with Amelia using payload signatures. ServiceNow calculates the request payload signature then attaches it in the X-Hub-Signature header. The ServiceNow script defines a variable with this secret key. In the examples below, secretKey is the name of this variable.

Amelia and ServiceNow use algorithms to calculate request payload signatures. These currently are HmacSHA256, HmacSHA384, HmacSHA512/224, and HmacSHA512/256. Amelia's ServiceNow Virtual Agent gateway workspace also lists these algorithms. Look for them in the Signature Algorithm field in the Basic tab. The ServiceNow Virtual Agent and Amelia gateway must use the same algorithm.

For invocations of Amelia's API, please see the topic flow code examples below. These examples are for discussion only.

#### Request and Response Payload Fields

The payload for HTTP POST requests and responses must be in application/json format.

<chapter title="Request JSON Payload Fields" collapsible="true" level="5">

*Supported Request JSON Payload Fields*

| Request Field          | Description                                                                                                                                                                           |
|------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| userUtterance          | The text entered in the Virtual Agent chat by the user.                                                                                                                               |
| gatewaySessionId       | The ID of the current chat session with  Amelia. With the first request message, Amelia generates a unique ID value. Every later request must include this ID.                         |
| userId                 | This fields maps to the externalUid field in  Amelia. The content of the field should be a unique identifier.Required for user creation when the integration uses authenticated users. |
| email                  | The email of the end user. Required for user creation when the integration uses authenticated users.                                                                                  |
| fullName               | The full name of the end user. Required for user creation when the integration uses authenticated users.                                                                              |
| conversationAttributes | Optional conversation attributes for the Amelia conversation.                                                                                                                         |
| endConversation        | An optional flag that may be set to true to end the conversation with  Amelia.                                                                                                         |



</chapter>


<chapter title="Response JSON Payload Fields" collapsible="true" level="5">

*Supported Response JSON Payload Fields (Amelia 4.3.12+)*

| Request Field             | Description                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
|---------------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| ameliaMessages            | An array of messages sent by  Amelia. Each message is a separate object in the JSON payload. Here is an example showing four different messages in a single response payload: <code-block lang="JavaScript"> { "ameliaMessages":[ { "integrationMessage":false, "message":"I am going to tell you about some LOTR characters." }, { "integrationMessage":false, "message":"&lt;h2&gt;Lord of the Rings Characters&lt;/h2&gt;&lt;table border=\"1\"&gt;&lt;tr&gt;&lt;th&gt;Name&lt;/th&gt;&lt;th&gt;Type&lt;/th&gt;&lt;th&gt;Info&lt;/th&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;Aragorn&lt;/td&gt;&lt;td&gt;Human&lt;/td&gt;&lt;td&gt;King&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;Gandalf&lt;/td&gt;&lt;td&gt;Mage&lt;/td&gt;&lt;td&gt;Magic&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;Frodo&lt;/td&gt;&lt;td&gt;Hobbit&lt;/td&gt;&lt;td&gt;Resilience&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;" }, { "integrationMessage":false, "message":"&lt;h2&gt;Some of their achievements&lt;/h2&gt;&lt;ol&gt;&lt;li&gt;Aragorn fought the Nazgul alone&lt;/li&gt;&lt;li&gt;Gandalf defeated Balrog&lt;/li&gt;&lt;li&gt;Frodo took the ring to Mordor&lt;/li&gt;&lt;/ol&gt;" }, { "integrationMessage":false, "message":"There is a lot more to say!" } ], "gatewaySessionId":"01222bbf-b205-423b-8dea-27246d7d2d35", "conversationClosed":false, "conversationClosedInError":false } </code-block> |
| gatewaySessionId          | The ID of the current chat session with  Amelia.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| conversationClosed        | Default is false. Set to true if Amelia closed the conversation.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| conversationClosedInError | Default is false. Set to true if Amelia closed the conversation due to an error.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| integrationMessage        | Default is false.Set to true for an individual message if it contains an integration message.An integration message is any free form text sent by an Amelia Builder flow or BPN process. ServiceNow topic process flows must look for this message and take appropriate action.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| message                   | An individual message sent by  Amelia. If the integrationMessage flag is true, this field contains an integration message. Otherwise, it contains the text message sent by  Amelia.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |



</chapter>



#### A Basic ServiceNow Topic Flow

This flow connects a ServiceNow topic to Amelia with an Amelia gateway. In this flow, the user talks to Amelia until the conversation closes or an error happens in  Amelia. If the conversation ends due to an error, an agent receives the escalated chat.
<chapter title="View Basic ServiceNow Topic Flow and Details" collapsible="true" level="5">


![B03-06_0129-SNowVirtAgt-BasicFlow](B03-06_0129-SNowVirtAgt-BasicFlow.png){width="900" style="block"}

*A Basic ServiceNow Topic Flow*

*Elements of a Basic ServiceNow Topic Flow*

| Topic Flow Element              | Description                                                                                                                                                      | Example Scripts (NOTFORPRODUCTION)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
|---------------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| User Input block                | The `vaVars.ameliamessage` variable presents Amelia's message to the user. This code resides in the Prompt section of the User Input, using a ServiceNow script. | This script presents Amelia's message(s) to the user: <code-block lang="JavaScript"> (function execute() { return vaVars.ameliaMessage; })() </code-block>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| Send User Input to Amelia block | The Send User Input To Amelia block uses another script to process and then send user input to  Amelia.                                                           | This example script sends one or more user messages to  Amelia. <code-block lang="JavaScript"> (function execute() { try { // send message to Amelia // prepare request body var userInput = vaInputs.user_input; var obj = {}; obj.userUtterance = "" + userInput; if (vaVars.gatewaySessionId != null) { obj.gatewaySessionId = vaVars.gatewaySessionId; } // add the below fields if using authenticated users // This example uses the ServiceNow username. However, // this field gets stored in Amelia as the externalUid, // and externalUid is not unique in  Amelia. // So, the client may prefer to prefix the externalUid // with the client name. They may also choose to use // the sys_id of the user instead, which is much longer // and therefore far more unique than username. The // sys_id is obtained simply by // obj.userId = "" + vaInputs.user.sys_id; obj.userId = "" + vaInputs.user.user_name; obj.email = "" + vaInputs.user.email; obj.fullName = "" + vaInputs.user.name; // add optional conversation attributes var conversationAttributes = {}; conversationAttributes.attributeX = "valueOfAttributeX"; conversationAttributes.attributeY = "valueOfAttributeY"; obj.conversationAttributes = conversationAttributes; var requestBody = new global.JSON().encode(obj); //JSON formatted string // calculate the signature of the request body var mac = new GlideCertificateEncryption; var secretKey = "secretHere"; // the secret is hardcoded in this example, // but it could be obtained through a more // secure means on the ServiceNow side. var signature = SncAuthentication.encode(requestBody, secretKey, "HmacSHA256"); //Options for Amelia versions 4.3.12 and later, must match Signature Algorithm field selected in Amelia's Service Now Virtual Agent gateway workspace, in the Basic tab // var signature = SncAuthentication.encode(requestBody, secretKey, "HmacSHA1"); //HmacSHA1 is supported by default only with Amelia version 4.3.11 and earlier versions vaVars.hash = signature; // prepare post request var baseUrl = "https://6610c404f261.ngrok.io"; var url = baseUrl + "/Amelia/gateway/service/snowva/123456789/api/messages"; var post = new sn_ws.RESTMessageV2(); post.setRequestBody(requestBody); post.setEndpoint(url); post.setHttpMethod('POST'); post.setRequestHeader("Content-Type","application/json"); post.setRequestHeader("X-Hub-Signature", signature); var response = post.execute(); var responseBody = response.getBody(); var responseJson = JSON.parse(responseBody); // for Amelia version 4.3.12 and later, use: vaVars.ameliaMessage = responseJson.ameliaMessages[0].message; // Note: This will only get the first message from the array. A production script should have logic to process all messages and not just the first one. // for Amelia version 4.3.11 and earlier, use: // vaVars.ameliaMessage = responseJson.ameliaMessage; vaVars.gatewaySessionId = responseJson.gatewaySessionId; vaVars.conversationClosed = responseJson.conversationClosed; vaVars.conversationClosedInError = responseJson.conversationClosedInError; vaVars.response = responseBody; } catch(ex) { vaVars.ameliaMessage = "There was an error."; vaVars.conversationClosed = true; vaVars.conversationClosedInError = true; } })() </code-block> |
| Loop? block                     | Capture the `vaVars.conversationClosed` and `vaVars.conversationClosedInError` values. The use the next block to determine the state of the conversation.        | This script determines if the conversation is closed or ongoing: <code-block lang="JavaScript"> //retrieve conversationClosed value (function execute() { return vaVars.conversationClosed; })() //retrieve conversationClosed value (function execute() { return !vaVars.conversationClosed; })() </code-block>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| Decision block                  | Next, determine whether the conversation was closed normally or due to an error.                                                                                 | This script determines whether the conversation was closed in error. <code-block lang="JavaScript"> //retrieve conversationClosedInError value (function execute() { return vaVars.conversationClosedInError; })() //retrieve conversationClosed and conversationClosedInError values (function execute() { return vaVars.conversationClosed &amp;&amp; !vaVars.conversationClosedInError;; })() </code-block>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| Forward to Agent block          | Forward this conversation to an agent.                                                                                                                           | <code-block lang="JavaScript"> (function execute() { if(vaSystem.isLiveAgentAvailable()) { vaSystem.connectToAgent() } else { // optionally send a message to the end user if no agents are available // vaVars.ameliaMessage = "No agents are available to assist."; } })() </code-block>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |



</chapter>



## Configure Amelia

After pre-configuration, you're ready to set the new gateway integration to interact with Amelia.

### Add a ServiceNow Virtual Agent Gateway

To do this:

1. From the **top left main** menu, click Digital Employees.

2. On the **left-side** menu, click Integrations. The Gateway Integrations panel opens between the left-side menu and the Home page.

3. In the Gateway Integrations panel, click + Add New.

4. From the Conversation Gateways group, click ServiceNow Virtual Agent.

#### Configure the Basic Tab

Open the following dropdown to learn about Basic tab elements.
<chapter title="Basic Tab Elements" collapsible="true" level="5">
Use this section to connect Amelia and your ServiceNow Virtual Agent account.

![B03-06_0129-SNowVirtAgt-Basic](B03-06_0129-SNowVirtAgt-Basic.png){width="900" style="block"}

*The Basic Tab*

*Basic Tab Elements*

| Element              | Default | Description                                                                                                                                                                                                                                                         |
|----------------------|---------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Name                 |         | {% include from="B03-06_GateCom-Name.md" element-id="B03-06_GateCom-Name_snippet" /%}                                                                                                                                                                          |
| Domain               |         | {% include from="B03-06_GateCom-Domain.md" element-id="B03-06_GateCom-Domain_snippet" /%}                                                                                                                                                                      |
| Gateway Service      |         | {% include from="B03-06_GateCom-GateSrv.md" element-id="B03-06_GateCom-GateSrv_snippet" /%}                                                                                                                                                                    |
| Deploy               | No      | {% include from="B03-06_GateCom-Deploy.md" element-id="B03-06_GateCom-Deploy_snippet" /%}                                                                                                                                                                      |
| Configuration Locale |         | {% include from="B03-06_GateCom-ConfigLocale.md" element-id="B03-06_GateCom-ConfigLocale_snippet" /%}                                                                                                                                                          |
| Configuration        |         |                                                                                                                                                                                                                                                                     |
| App ID               |         | Type the ServiceNow App ID.                                                                                                                                                                                                                                         |
| App Secret           |         | Type the ServiceNow App Secret.                                                                                                                                                                                                                                     |
| Signature Algorithm  |         | The signature algorithm used to calculate the payload signature in the topic script. Supported algorithms are HmacSHA256, HmacSHA384, HmacSHA512/224, and HmacSHA512/256. This value must match any ServiceNow topic flow script that defines the algorithm to use. |



</chapter>


<chapter title="Configuration Tab Elements" collapsible="true" level="5">
The table that follows shows each element, it's defaults and a short description of the setting's behavior. This information will help you further customize your Amelia gateway instance.

![B03-06_0129-SNowVirtAgt-Config](B03-06_0129-SNowVirtAgt-Config.png){width="900" style="block"}

*The Configuration Tab*

*Configuration Tab Elements*

| Element                                                 | Default                                              | Description                                                                                                              |
|---------------------------------------------------------|------------------------------------------------------|--------------------------------------------------------------------------------------------------------------------------|
| Channel                                                 | snowvirtualagent                                     | {% include from="B03-06_GateCom-Channel.md" element-id="B03-06_GateCom-Channel_snippet" /%}                         |
| Amelia Conversation Request Timeout (seconds)           | 30                                                   | {% include from="B03-06_GateCom-ConvReqTimeout.md" element-id="B03-06_GateCom-ConvReqTimeout_snippet" /%}           |
| Authenticated Users                                     | No                                                   | {% include from="B03-06_GateCom-AuthUsers.md" element-id="B03-06_GateCom-AuthUsers_snippet" /%}                     |
| Suppress Amelia's First Utterance                       | Yes                                                  | {% include from="B03-06_GateCom-SuppressFirstUtter.md" element-id="B03-06_GateCom-SuppressFirstUtter_snippet" /%}   |
| Support Present Content                                 | Yes                                                  | {% include from="B03-06_GateCom-SupportPresent.md" element-id="B03-06_GateCom-SupportPresent_snippet" /%}           |
| Chat Settings                                           |                                                      |                                                                                                                          |
| Enable Chat Timeout                                     | Yes                                                  | {% include from="B03-06_GateCom-EnableChatTO.md" element-id="B03-06_GateCom-EnableChatTO_snippet" /%}               |
| Chat Timeout Seconds                                    | 900                                                  | {% include from="B03-06_GateCom-ChatTOSeconds.md" element-id="B03-06_GateCom-ChatTOSeconds_snippet" /%}             |
| Enable Chat Timeout Message                             | Yes                                                  | {% include from="B03-06_GateCom-EnableChatTOMsg.md" element-id="B03-06_GateCom-EnableChatTOMsg_snippet" /%}         |
| Chat Timeout Message                                    | This conversation has been closed due to inactivity. | {% include from="B03-06_GateCom-ChatTOMsg.md" element-id="B03-06_GateCom-ChatTOMsg_snippet" /%}                     |
| Conversation Settings                                   |                                                      |                                                                                                                          |
| Enable Close Conversation on User Message               | Yes                                                  | {% include from="B03-06_GateCom-EnableCloseConv.md" element-id="B03-06_GateCom-EnableCloseConv_snippet" /%}         |
| User Close Conversation Message                         | /close                                               | {% include from="B03-06_GateCom-UserCloseConvMsg.md" element-id="B03-06_GateCom-UserCloseConvMsg_snippet" /%}       |
| Enable Conversation Restart on User Message             | Yes                                                  | {% include from="B03-06_GateCom-EnableConvRestart.md" element-id="B03-06_GateCom-EnableConvRestart_snippet" /%}     |
| User Restart Conversation Message                       | /restart                                             | {% include from="B03-06_GateCom-UserRestartConvMsg.md" element-id="B03-06_GateCom-UserRestartConvMsg_snippet" /%}   |
| Enable Chat Close Message                               | Yes                                                  | {% include from="B03-06_GateCom-EnableChatClosedMsg.md" element-id="B03-06_GateCom-EnableChatClosedMsg_snippet" /%} |
| Chat Closed Message                                     | This conversation has been closed                    | {% include from="B03-06_GateCom-ChatClosedMsg.md" element-id="B03-06_GateCom-ChatClosedMsg_snippet" /%}             |
| Add User Information to Initial Conversation Attributes | No                                                   | {% include from="B03-06_GateCom-AddUserInfoAttr.md" element-id="B03-06_GateCom-AddUserInfoAttr_snippet" /%}         |
| User First Name Attribute                               | userFirstName                                        | {% include from="B03-06_GateCom-UserFNameAttr.md" element-id="B03-06_GateCom-UserFNameAttr_snippet" /%}             |
| User Last Name Attribute                                | userLastName                                         | {% include from="B03-06_GateCom-UserLNameAttr.md" element-id="B03-06_GateCom-UserLNameAttr_snippet" /%}             |
| User Email Attribute                                    | userEmail                                            | {% include from="B03-06_GateCom-UserEmailAttr.md" element-id="B03-06_GateCom-UserEmailAttr_snippet" /%}             |
| User External UID Attribute                             | userExternalUid                                      | {% include from="B03-06_GateCom-UserIDAttr.md" element-id="B03-06_GateCom-UserIDAttr_snippet" /%}                   |


</chapter>

#### Configure the Additional Tab {% #Configur %}

The Additional Properties tab settings define how the gateway will behave, for example, in a conversation restart. Open the following dropdown to learn about Additional Properties tab elements.
<chapter title="The Additional Properties Tab" collapsible="true" level="5">
The table that follows shows each element, it's defaults and a short description of the setting's behavior. This information will help you further customize your Amelia gateway instance.

![B03-06_0129-SNowVirtAgt-AddtlProps](B03-06_0129-SNowVirtAgt-AddtlProps.png){width="900" style="block"}

*The Additional Properties Tab*

*Additional Properties Tab Elements*

|                                 Element                                 |             Default              |                                                                                     Description                                                                                      |
|-------------------------------------------------------------------------|----------------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Amelia Response Timeout for incoming calls from ServiceNow (in seconds) | 30                               | Defines the timeout if Amelia fails to respond to a POST message sent from a Virtual Agent topic script.                                                                             |
| Response when an error occurs in Amelia                                 | There was an error. Please hold. | Defines the response sent by Amelia in the ameliaMessage response parameter when an error occurs in  Amelia.                                                                          |
| Name of the conversation attribute that has the locale                  | locale                           | Defines the name of the conversation attribute sent by the ServiceNow Virtual Agent topic that has the locale for the conversation. By default, the name of the attribute is locale. |


</chapter>


## More Resources

{% include from="B03-06_0105-GatewayMoreLinks.md" element-id="B03-06_0105-GatewayMoreLinks_snippet" /%}